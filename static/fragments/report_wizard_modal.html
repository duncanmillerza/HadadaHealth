<!-- Report Creation Wizard Modal - 5-Step Process -->
<div id="report-wizard-modal" class="modal unified-modal" style="display: none;">
    <div class="modal-content large-modal wizard-modal">
        <!-- Modal Header with Progress Indicator -->
        <div class="modal-header">
            <h3 id="wizard-modal-title">Create Report</h3>
            <div class="wizard-progress">
                <div class="progress-steps">
                    <div class="progress-step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Patient</div>
                    </div>
                    <div class="progress-connector"></div>
                    <div class="progress-step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Type & Title</div>
                    </div>
                    <div class="progress-connector"></div>
                    <div class="progress-step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Disciplines</div>
                    </div>
                    <div class="progress-connector"></div>
                    <div class="progress-step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Therapists</div>
                    </div>
                    <div class="progress-connector"></div>
                    <div class="progress-step" data-step="5">
                        <div class="step-circle">5</div>
                        <div class="step-label">Priority & Timeline</div>
                    </div>
                </div>
            </div>
            <span class="close-button" id="close-wizard-modal">&times;</span>
        </div>
        
        <!-- Modal Body with Steps -->
        <div class="modal-body wizard-body">
            <div class="wizard-container">
                <!-- Step Content Area -->
                <div class="wizard-steps">
                    
                    <!-- Step 1: Select Patient -->
                    <div id="wizard-step-1" class="wizard-step active">
                        
                        <div class="patient-selection-section">
                            <!-- Patient Search -->
                            <div class="form-group">
                                <label for="wizard-patient-search">Search Patient</label>
                                <div class="search-input-group">
                                    <input type="text" id="wizard-patient-search" placeholder="Search by name, MRN, or ID..." />
                                    <div class="search-spinner" style="display: none;">üîç</div>
                                </div>
                                <div id="wizard-patient-results" class="search-results">
                                    <!-- Search results will appear here -->
                                </div>
                            </div>
                            
                            <!-- Selected Patient Preview - Moved higher for immediate feedback -->
                            <div id="wizard-selected-patient" class="selected-patient-preview" style="display: none;">
                                <div class="patient-card">
                                    <div class="patient-info">
                                        <h5 id="selected-patient-name"></h5>
                                        <div class="patient-details">
                                            <span id="selected-patient-dob"></span>
                                            <span id="selected-patient-id"></span>
                                        </div>
                                    </div>
                                    <button type="button" class="btn-link" onclick="clearSelectedPatient()">Change</button>
                                </div>
                            </div>
                            
                            <!-- Recent Patients -->
                            <div class="recent-patients-section">
                                <h5>Recent Patients</h5>
                                <div id="wizard-recent-patients" class="recent-patients-list">
                                    <!-- Recent patients will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 2: Report Type & Title -->
                    <div id="wizard-step-2" class="wizard-step">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="wizard-report-type">Report Type *</label>
                                <select id="wizard-report-type" required>
                                    <option value="">Select report type...</option>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="wizard-template">Template *</label>
                                <select id="wizard-template" required>
                                    <option value="">Select template...</option>
                                    <!-- Templates will be populated based on report type -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="wizard-title">Report Title *</label>
                            <input type="text" id="wizard-title" placeholder="Report title will be auto-generated..." required />
                            <button type="button" class="btn-secondary" onclick="generateWizardTitle()">
                                <i class="fas fa-magic"></i> Auto-Generate
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Disciplines -->
                    <div id="wizard-step-3" class="wizard-step">
                        
                        <!-- Disciplines with Booking History -->
                        <div class="disciplines-with-history-section">
                            <h5>Select Disciplines</h5>
                            <div id="wizard-disciplines-list" class="disciplines-compact-grid">
                                <!-- Disciplines with booking counts will be populated here by JavaScript -->
                                <div class="discipline-compact-option">
                                    <input type="checkbox" id="discipline-physiotherapy" value="physiotherapy" />
                                    <label for="discipline-physiotherapy" class="discipline-compact-card">
                                        <div class="discipline-title">Physiotherapy</div>
                                        <div class="discipline-stats">
                                            <span class="booking-count">0 bookings</span>
                                            <span class="last-seen">Never</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="discipline-compact-option">
                                    <input type="checkbox" id="discipline-occupational-therapy" value="occupational_therapy" />
                                    <label for="discipline-occupational-therapy" class="discipline-compact-card">
                                        <div class="discipline-title">Occupational Therapy</div>
                                        <div class="discipline-stats">
                                            <span class="booking-count">0 bookings</span>
                                            <span class="last-seen">Never</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="discipline-compact-option">
                                    <input type="checkbox" id="discipline-speech-therapy" value="speech_therapy" />
                                    <label for="discipline-speech-therapy" class="discipline-compact-card">
                                        <div class="discipline-title">Speech Therapy</div>
                                        <div class="discipline-stats">
                                            <span class="booking-count">0 bookings</span>
                                            <span class="last-seen">Never</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="discipline-compact-option">
                                    <input type="checkbox" id="discipline-psychology" value="psychology" />
                                    <label for="discipline-psychology" class="discipline-compact-card">
                                        <div class="discipline-title">Psychology</div>
                                        <div class="discipline-stats">
                                            <span class="booking-count">0 bookings</span>
                                            <span class="last-seen">Never</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="discipline-validation-message" style="display: none;">
                            <span class="error-text">Please select at least one discipline.</span>
                        </div>
                    </div>
                    
                    <!-- Step 4: Therapists -->
                    <div id="wizard-step-4" class="wizard-step">
                        
                        <!-- Therapists Selection -->
                        <div class="therapists-with-history-section">
                            <h5>Select Therapists</h5>
                            <div id="wizard-therapists-list" class="therapists-compact-grid">
                                <!-- Therapists with treatment history will be populated here by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="therapist-validation-message" style="display: none;">
                            <span class="error-text">Please select at least one therapist.</span>
                        </div>
                    </div>
                    
                    <!-- Step 5: Priority & Timeline -->
                    <div id="wizard-step-5" class="wizard-step">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="wizard-priority">Priority Level *</label>
                                <div class="priority-options">
                                    <div class="priority-option">
                                        <input type="radio" id="priority-low" name="wizard-priority" value="1" />
                                        <label for="priority-low" class="priority-card low">
                                            <div class="priority-indicator"></div>
                                            <div class="priority-details">
                                                <div class="priority-name">Low</div>
                                                <div class="priority-description">Standard timeline</div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="priority-option">
                                        <input type="radio" id="priority-medium" name="wizard-priority" value="2" checked />
                                        <label for="priority-medium" class="priority-card medium">
                                            <div class="priority-indicator"></div>
                                            <div class="priority-details">
                                                <div class="priority-name">Medium</div>
                                                <div class="priority-description">Normal priority</div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="priority-option">
                                        <input type="radio" id="priority-high" name="wizard-priority" value="3" />
                                        <label for="priority-high" class="priority-card high">
                                            <div class="priority-indicator"></div>
                                            <div class="priority-details">
                                                <div class="priority-name">High</div>
                                                <div class="priority-description">Urgent - 2 days</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="wizard-deadline">Deadline (Optional)</label>
                                <input type="date" id="wizard-deadline" />
                                <div class="deadline-shortcuts">
                                    <button type="button" class="deadline-shortcut" onclick="setWizardDeadline(7)">1 week</button>
                                    <button type="button" class="deadline-shortcut" onclick="setWizardDeadline(14)">2 weeks</button>
                                    <button type="button" class="deadline-shortcut" onclick="setWizardDeadline(30)">1 month</button>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        <!-- Modal Footer with Navigation -->
        <div class="modal-footer wizard-footer">
            <div class="footer-left">
                <button id="wizard-back-btn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
            </div>
            <div class="footer-right">
                <button id="wizard-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="wizard-next-btn" class="btn btn-primary" disabled>
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button id="wizard-finish-btn" class="btn btn-success" style="display: none;">
                    <i class="fas fa-check"></i> Create Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Backdrop -->
<div id="report-wizard-backdrop" class="modal-backdrop" style="display: none;"></div>

<!-- Discipline Recommendation Tooltip -->
<div id="discipline-tooltip" class="recommendation-tooltip" style="display: none;">
    <div class="tooltip-content">
        <div class="tooltip-header">
            <strong>Recommended</strong>
        </div>
        <div class="tooltip-body">
            <div class="booking-stats">
                <span class="booking-count"></span>
                <span class="last-seen"></span>
            </div>
        </div>
    </div>
</div>

<!-- Therapist Suggestion Tooltip -->
<div id="therapist-tooltip" class="recommendation-tooltip" style="display: none;">
    <div class="tooltip-content">
        <div class="tooltip-header">
            <strong>Previous Treatment History</strong>
        </div>
        <div class="tooltip-body">
            <div class="treatment-stats">
                <span class="treatment-count"></span>
                <span class="last-treatment"></span>
            </div>
        </div>
    </div>
</div>