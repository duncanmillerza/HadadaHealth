<!-- Report Editor Modal with AI Content Highlighting -->
<div id="report-editor-modal" class="modal unified-modal" style="display: none;">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>
                <span class="modal-icon">üìù</span>
                <span id="editor-title">Edit Report</span>
            </h2>
            <button class="close-btn" onclick="closeReportEditor()">&times;</button>
        </div>
        
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
            <!-- Report Metadata -->
            <div class="editor-section">
                <div class="section-header">
                    <h3>Report Information</h3>
                    <div class="ai-legend">
                        <span class="legend-item">
                            <span class="ai-indicator ai-generated"></span>
                            AI Generated
                        </span>
                        <span class="legend-item">
                            <span class="ai-indicator human-edited"></span>
                            Human Modified
                        </span>
                        <span class="legend-item">
                            <span class="ai-indicator human-added"></span>
                            Human Added
                        </span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="report-title-editor">Report Title</label>
                    <input type="text" id="report-title-editor" class="form-control" placeholder="Report title">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="patient-name-editor">Patient Name</label>
                        <input type="text" id="patient-name-editor" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label for="report-date-editor">Report Date</label>
                        <input type="date" id="report-date-editor" class="form-control">
                    </div>
                </div>
            </div>
            
            <!-- Content Editor -->
            <div class="editor-section">
                <div class="section-header">
                    <h3>Report Content</h3>
                    <div class="editor-actions">
                        <button type="button" class="btn btn-outline" onclick="toggleAIHighlighting()">
                            <span id="ai-highlight-btn-text">Hide AI Highlights</span>
                        </button>
                        <button type="button" class="btn btn-outline" onclick="regenerateAIContent()">
                            <i class="fas fa-robot"></i> Regenerate AI Content
                        </button>
                        <button type="button" class="btn btn-outline" onclick="addSection()">
                            <i class="fas fa-plus"></i> Add Section
                        </button>
                    </div>
                </div>
                
                <!-- Content Sections -->
                <div id="content-sections">
                    <!-- Dynamically populated sections -->
                </div>
                
                <!-- Add Section Template (Hidden) -->
                <template id="section-template">
                    <div class="content-section" data-section-id="">
                        <div class="section-controls">
                            <input type="text" class="section-title-input" placeholder="Section Title" />
                            <div class="section-buttons">
                                <button type="button" class="btn-icon" onclick="moveSection(this, 'up')" title="Move Up">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button type="button" class="btn-icon" onclick="moveSection(this, 'down')" title="Move Down">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <button type="button" class="btn-icon delete" onclick="deleteSection(this)" title="Delete Section">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-container">
                            <textarea class="content-editor" placeholder="Section content..."></textarea>
                        </div>
                        <div class="section-metadata">
                            <span class="ai-status">Status: <span class="status-text">Human Added</span></span>
                            <span class="word-count">Words: <span class="count">0</span></span>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- AI Suggestions Panel -->
            <div class="editor-section" id="ai-suggestions-panel" style="display: none;">
                <div class="section-header">
                    <h3>AI Suggestions</h3>
                    <button type="button" class="btn btn-sm btn-outline" onclick="refreshSuggestions()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
                <div id="ai-suggestions-content">
                    <div class="suggestions-loading">
                        <div class="loading-spinner"></div>
                        <p>Analyzing content for suggestions...</p>
                    </div>
                </div>
            </div>
            
            <!-- Revision History -->
            <div class="editor-section">
                <div class="section-header">
                    <h3>Revision History</h3>
                    <button type="button" class="btn btn-sm btn-outline" onclick="toggleRevisionHistory()">
                        <span id="history-toggle-text">Show History</span>
                    </button>
                </div>
                <div id="revision-history" style="display: none;">
                    <div class="revision-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <div class="footer-left">
                <span class="save-status" id="save-status">All changes saved</span>
                <button type="button" class="btn btn-outline" onclick="previewReport()">
                    <i class="fas fa-eye"></i> Preview
                </button>
            </div>
            <div class="footer-right">
                <button type="button" class="btn btn-secondary" onclick="saveAsDraft()">
                    Save as Draft
                </button>
                <button type="button" class="btn btn-secondary" onclick="closeReportEditor()">
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveAndFinalize()">
                    Save & Finalize
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Report Preview Modal -->
<div id="report-preview-modal" class="modal unified-modal" style="display: none;">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>
                <span class="modal-icon">üëÅÔ∏è</span>
                Report Preview
            </h2>
            <button class="close-btn" onclick="closeReportPreview()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="preview-content" id="preview-content">
                <!-- Generated report preview -->
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeReportPreview()">
                Close Preview
            </button>
            <button type="button" class="btn btn-primary" onclick="exportToPDF()">
                <i class="fas fa-file-pdf"></i> Export PDF
            </button>
        </div>
    </div>
</div>