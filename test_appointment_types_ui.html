<!DOCTYPE html>
<html>
<head>
    <title>Test Appointment Types UI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Appointment Types UI Test</h1>
    <div id="test-results"></div>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        // Test 1: Check if the server is running
        fetch('http://localhost:8000/appointment-types-management-page')
            .then(response => {
                if (response.ok) {
                    addResult('success', '✅ Server is running and appointment types page is accessible');
                    return testAPI();
                } else {
                    addResult('error', '❌ Server responded with error: ' + response.status);
                }
            })
            .catch(error => {
                addResult('error', '❌ Cannot connect to server: ' + error.message);
            });
        
        // Test 2: Check API endpoints
        async function testAPI() {
            try {
                const response = await fetch('http://localhost:8000/api/practices/1/appointment-types/effective?enabled_only=false');
                if (response.ok) {
                    const data = await response.json();
                    addResult('success', `✅ API endpoint working - loaded ${data.length} appointment types`);
                    
                    // Check for categories with children
                    const categoriesWithChildren = data.filter(type => !type.parent_id);
                    const childTypes = data.filter(type => type.parent_id);
                    
                    addResult('info', `📊 Found ${categoriesWithChildren.length} categories and ${childTypes.length} child appointment types`);
                    
                    if (childTypes.length === 0) {
                        addResult('error', '⚠️ No child appointment types found - this might explain why they are not showing in the UI');
                    }
                    
                    // Show data structure
                    categoriesWithChildren.forEach(category => {
                        const children = childTypes.filter(child => child.parent_id === category.id);
                        addResult('info', `📁 ${category.name}: ${children.length} child types`);
                    });
                    
                } else {
                    addResult('error', '❌ API endpoint failed: ' + response.status);
                }
            } catch (error) {
                addResult('error', '❌ API test failed: ' + error.message);
            }
        }
        
        addResult('info', '🔍 Running appointment types UI tests...');
    </script>
</body>
</html>